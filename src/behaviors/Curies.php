<?php

namespace roaresearch\yii2\roa\behaviors;

use yii\{helpers\Url, web\Link};

/**
 * Behavior to autogenerate curies links.
 *
 * @author Angel (Faryshta) Guevara <aguevara@alquimiadigital.mx>
 */
class Curies extends \yii\base\Behavior
{
    /**
     * @var Link[] The curies links. Autogenerated links will be stored here.
     */
    public array $curiesLinks = [];

    /**
     * @var ?string name of the autogenerated expand curie. Set `null` if you
     * don't want to autogenerate expand curie.
     */
    public ?string $expandCurieName = 'expand';

    /**
     * @var array the configuration used to generate the expand curie.
     */
    public array $expandCurieLink = [
        'title' => 'Embeddable related resources.',
    ];

    /**
     * Return all the curies and related links.
     *
     * @return array the configured and autogenerated curies and related links.
     */
    public function getCuriesLinks(): array
    {
        if ($this->expandCurieName) {
            $this->curiesLinks['curies'][] = new Link(array_merge(
                $this->expandCurieLink,
                [
                    'name' => $this->expandCurieName,
                    'href' => $this->owner->getSelfLink()
                        . "?{$this->expandCurieName}={rel}",
                ]
            ));

            foreach ($this->owner->extraFields() as $field => $value) {
                if (is_int($field)) {
                    $field = $value;
                }

                $this->curiesLinks["{$this->expandCurieName}:$field"] = $field;
            }
        }

        return $this->curiesLinks;
    }
}
